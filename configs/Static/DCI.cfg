ip routing ipv6 interfaces
ipv6 unicast-routing


interface loopback0
  ip address 192.168.254.101/32
interface Ethernet1
  no switchport
  mtu 9214
  ipv6 enable
interface Ethernet2
  no switchport
  mtu 9214
  ipv6 enable
interface Ethernet3
  no switchport
  mtu 9214
  ipv6 enable
interface Ethernet4
  no switchport
  mtu 9214
  ipv6 enable

service routing protocols model multi-agent

ip prefix-list LOOPBACK
    seq 10 permit 192.168.101.0/24 eq 32
    seq 20 permit 192.168.102.0/24 eq 32
    seq 30 permit 192.168.201.0/24 eq 32
    seq 40 permit 192.168.202.0/24 eq 32
    seq 50 permit 192.168.254.0/24 eq 32

route-map LOOPBACK permit 10
   match ip address prefix-list LOOPBACK


router bgp 65000
   router-id 192.168.254.101
   maximum-paths 3
   distance bgp 20 200 200

   bgp default ipv4-unicast transport ipv6
   bgp default ipv6-unicast
   neighbor UNDERLAY peer group
   redistribute connected


   neighbor interface Ethernet1 peer-group UNDERLAY remote-as 65103
   neighbor interface Ethernet2 peer-group UNDERLAY remote-as 65103
   neighbor interface Ethernet3 peer-group UNDERLAY remote-as 65203
   neighbor interface Ethernet4 peer-group UNDERLAY remote-as 65203


    neighbor EVPN update-source Loopback0
    neighbor EVPN ebgp-multihop 
    neighbor EVPN send-community extended
    neighbor EVPN maximum-routes 0
    

    neighbor 192.168.101.21 peer group EVPN
    neighbor 192.168.101.22 peer group EVPN
    neighbor 192.168.201.21 peer group EVPN
    neighbor 192.168.201.22 peeer group EVPN
  
  
    address-family ipv4
      bgp next-hop address-family ipv6
      neighbor UNDERLAY activate
      neighbor UNDERLAY next-hop address-family ipv6 originate
      redistribute connected route-map LOOPBACK

    address-family ipv6
        neighbor UNDERLAY activate
    address-family evpn
      neighbor EVPN activate


