service routing protocols model multi-agent

ip prefix-list LOOPBACK
    seq 10 permit 192.168.101.0/24 eq 32
    seq 20 permit 192.168.102.0/24 eq 32
 
route-map LOOPBACK permit 10
   match ip address prefix-list LOOPBACK


router bgp 65200
   router-id 192.168.201.101
   maximum-paths 3
   distance bgp 20 200 200

   bgp default ipv4-unicast transport ipv6
   bgp default ipv6-unicast
   neighbor UNDERLAY peer group
   redistribute connected


   neighbor interface Ethernet2 peer-group UNDERLAY remote-as 65201
   neighbor interface Ethernet3 peer-group UNDERLAY remote-as 65201
   neighbor interface Ethernet4 peer-group UNDERLAY remote-as 65202
   neighbor interface Ethernet5 peer-group UNDERLAY remote-as 65202
   neighbor interface Ethernet6 peer-group UNDERLAY remote-as 65203
   neighbor interface Ethernet7 peer-group UNDERLAY remote-as 65203


    neighbor EVPN update-source Loopback0
    neighbor EVPN ebgp-multihop 
    neighbor EVPN send-community extended
    neighbor EVPN maximum-routes 0
    

    neighbor 192.168.201.101 peer group EVPN
    neighbor 192.168.201.102 peer group EVPN
    neighbor 192.168.201.103 peer group EVPN
  
    bgp listen range 192.168.101.0/24 peer-group EVPN peer-filter LEAF-AS-RANGE

   
    address-family ipv4
      bgp next-hop address-family ipv6
      neighbor UNDERLAY activate
      neighbor UNDERLAY next-hop address-family ipv6 originate
      redistribute connected route-map LOOPBACK

    address-family ipv6
        neighbor UNDERLAY activate
    address-family evpn
      neighbor EVPN activate

