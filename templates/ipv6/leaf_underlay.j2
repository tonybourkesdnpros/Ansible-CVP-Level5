service routing protocols model multi-agent

ip virtual-router mac-address 001c.7300.0099


ip prefix-list LOOPBACK
    seq 10 permit 192.168.101.0/24 eq 32
    seq 20 permit 192.168.102.0/24 eq 32
 

route-map LOOPBACK permit 10
   match ip address prefix-list LOOPBACK


router bgp {{ underlay[inventory_hostname]['BGP']['ASN'] }}
   router-id {{ underlay[inventory_hostname]['interfaces']['loopback0']['ipv4']}}
   maximum-paths 3
   distance bgp 20 200 200



   bgp default ipv4-unicast transport ipv6
   bgp default ipv6-unicast
   neighbor UNDERLAY peer group

{% for interface in underlay[inventory_hostname]['interfaces'] %}
{% if 'thernet' in interface %}
   neighbor interface {{interface}} peer-group UNDERLAY remote-as {{ underlay[inventory_hostname]['BGP']['spine-ASN'] }}
{% endif %}
{% endfor %}
   redistribute connected

   neighbor LEAF_Peer peer group
   neighbor LEAF_Peer remote-as {{ underlay[inventory_hostname]['BGP']['ASN'] }}
   neighbor LEAF_Peer next-hop-self
   neighbor LEAF_Peer maximum-routes 12000

{% if underlay[inventory_hostname]['MLAG'] == "Odd" %}
   neighbor 192.168.255.2 peer group LEAF_Peer 
   {% else %}
   neighbor 192.168.255.1 peer group LEAF_Peer 
{% endif %}

   neighbor EVPN peer group
 
   neighbor EVPN remote-as {{ underlay['global']['DC1']['spine_ASN']}} 
 
  
   neighbor EVPN update-source Loopback0
   neighbor EVPN ebgp-multihop 
   neighbor EVPN send-community extended
   neighbor EVPN maximum-routes 0

{% set DC_list = inventory_hostname.split('-') %}
{% set DC = DC_list[1] %}
{% for peer in underlay['global'][DC]['spine_peers'] %}
   neighbor {{ peer }} peer group EVPN
{% endfor %}  
 
   
   address-family ipv4
      bgp next-hop address-family ipv6
      neighbor UNDERLAY activate
      neighbor UNDERLAY next-hop address-family ipv6 originate
      neighbor LEAF_Peer activate
      redistribute connected route-map LOOPBACK
   
   address-family evpn
      neighbor EVPN activate


{# address-family ipv6
      neighbor UNDERLAY activate#}


